from config import lst_ofcurrency
import requests
import json


class ConvertExeption(Exception): # –Ω–∞—à–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    pass


class ConvertCurrency: #–∫–ª–∞—Å—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è JSON-–æ—Ç–≤–µ—Ç–∞(—Å—Ç–æ–∏–º–æ—Å—Ç—å, –ø–æ–ª—É—á–µ–Ω–Ω–∞—è –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ)
    @staticmethod
    def get_price(quote, base):  # —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –æ—Ç –∫–ª–∞—Å—Å–∞ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
        # –Ω—É–∂–Ω–æ–≥–æ JSON –æ–±—ä–µ–∫—Ç–∞
        if quote == base:  # –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –≤–∞–ª—é—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç, –¥–∞–ª–µ–µ –≤ —Ñ–∞–π–ª–µ functions –±—É–¥–µ–º –ª–æ–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
            raise ConvertExeption("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–∞–ª—é—Ç—ã –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞ üö´")

        try:
            quote_position = lst_ofcurrency[quote]
        except KeyError:  # –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ, –µ—Å–ª–∏ –ø–µ—Ä–≤–∞—è –Ω–∞–ø–∏—Å–∞–Ω–Ω–∞—è –≤–∞–ª—é—Ç–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –∏–ª–∏ –µ—ë –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ
            raise ConvertExeption(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞–ª—é—Ç—É '{quote}'üîÅ‚ùå")

        try:
            base_position = lst_ofcurrency[base]
        except KeyError:  # –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ, –µ—Å–ª–∏ –≤—Ç–æ—Ä–∞—è –Ω–∞–ø–∏—Å–∞–Ω–Ω–∞—è –≤–∞–ª—é—Ç–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –∏–ª–∏ –µ—ë –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ
            raise ConvertExeption(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞–ª—é—Ç—É '{base}'üîÅ‚ùå")

        r = requests.get(f"https://min-api.cryptocompare.com/data/price?fsym={quote_position}&tsyms={base_position}")  # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º get-HTTP
        # –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        result = json.loads(r.content)[base_position]  # –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ JSON —Ñ–æ—Ä–º–∞—Ç–∞ –≤ Python —Ñ–æ—Ä–º–∞—Ç, –∏ –±–µ—Ä—ë–º JSON –æ—Ç base_position
        # base_position = lst_ofcurrency[quote] = –∑–Ω–∞—á–µ–Ω–∏—é –∫–ª—é—á–∞, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∏–º –æ—Ç–≤–µ—Ç –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –∫–ª—é—á–∞, –Ω–æ –≤ JSON
        # –æ—Ç–≤–µ—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –±—É–¥–µ—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –ö–õ–Æ–ß–û–ú ! –¥–ª—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        return result  # –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ
